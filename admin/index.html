<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" type="text/css" href="style.css">
	<title>Login</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- IMPORT FONTS -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300|Open+Sans&display=swap" rel="stylesheet">

	<!-- ICONS !-->
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.7.0/css/all.css'>

	<!-- JQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <script>

      $(document).ready(function(){
      	$('form').submit(false);
      	$('#menu').css('display', 'none');
      	$('.res').css('display', 'none');
      	$('.popup').css('display', 'none');

        var user,pass,token;
        $("#login-submit").click(function(){
          user=$("#login-username").val();
          pass=$("#login-password").val();
          //$('#login-err').text(user+" " +pass);
          $.post("https://iic.devclub.in/login",{username: user,password: pass}, function(data){
            if(data.status){
            	token=data.data.token;
            	$('#login-err').css('color','green');
            	$('#login-err').text("Logging in...");
            	$.ajax({
            	    url: 'https://iic.devclub.in/api/admin',
            	    type: 'get',
            	    
            	    headers: {
            	        Authorization: token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
            	    success: function (data) {
            	        console.info(data);
            	    }
            	});
            	$('.login').fadeOut(function(){
            		$('title').text("Welcome "+user);
            		$('#menu').slideDown();
            	});



            }
            else
              {
                //alert("Failed");
                $('#login-err').css('color','red');
                $('#login-err').text(data.message);
              }        
          });
        });

        $.Edit = function(what,id){ 

        	if (what=="events"){
        		$.ajax({
	                 url: 'https://iic.devclub.in/api/admin/events/'+id,
	                 type: 'get',
            	    
            	    headers: {
            	        Authorization: token  
            	    },
            	    dataType: 'json',
	                 success: function (data) {
	                 	//$('.popup div').html("");
	                 	//$('.popup div').append("<table border='1'></table>");
	                 	//$('.popup div table').append("<tr><td>title</td><td><input type='text' ")
	                 	alert("Full feature coming soon! see console for now...");
	                     console.info(data);
	                 }
	             });
        	}
           }


        $("#menu-events").click(function(){
	        $('.popup').fadeOut();
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/events',
	                 type: 'get',
            	    
            	    headers: {
            	        Authorization: token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
	                 success: function (data) {
	                 	$(".res").html("<table border='1'></table>");


	                 	let authors = data.data;
	                 	 authors.map(function(author) {
	                 		$(".res>table").append("<tr><td>"+`${author.metaData.title}`+"</td><td>"+`${author.metaData.eventDate}`+"</td><td>"+`${author.metaData.eventTime}`+"</td><td>"+`${author.metaData.venue}`+"</td><td>"+`${author.metaData.organiser}`+"</td><td><a onclick=\"$.Edit('events','"+`${author._id}`+"')\" >edit</td></tr>");});

	                 	    
	                 	   
						$('.res').fadeIn();

	                     //console.info(data);
	                
	                 }
	             });
	    });

	    $("#menu-blogs").click(function(){
	        $('.popup').fadeOut();
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/blog',
	                 type: 'get',
            	    
            	    headers: {
            	        Authorization: token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
	                 success: function (data) {
	                     console.info(data);
	                 }
	             });
	    });

	    $("#menu-resources").click(function(){
	        $('.popup').fadeOut();
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/resources',
	                 type: 'get',
            	    
            	    headers: {
            	        Authorization: token  //for object property name, use quoted notation shown
            	    },

            	    dataType: 'json',
	                 success: function (data) {
	                     console.info(data);
	                 }
	             });
	    });

	    $("#menu-showcase").click(function(){
	        $('.popup').fadeOut();
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/showcase',
	                 type: 'get',
            	    
            	    headers: {
            	        Authorization: token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
	                 success: function (data) {
	                     console.info(data);
	                 }
	             });
	    });

	    $("#menu-team").click(function(){
	    	$('.popup').fadeOut();
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/team',
	                 type: 'get',
            	    
            	    headers: {
            	        Authorization: token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
	                 success: function (data) {
	                     console.info(data);
	                 }
	             });
	    });

	    


	    $("#menu-users").click(function(){

	    	$('.tab>div').removeClass('selected');
	    	$('#menu-users').addClass('selected');

	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/users',
	                 type: 'get',
            	    
            	    headers: {
            	        Authorization: token 
            	    },
            	    dataType: 'json',
	                 success: function (data) {

	                 	$(".res").html("<a class='btn add' id='addnewuser-btn'>Add</a><table border='1'><thead><tr><th class='sticky'>Username</th><th>Name</th><th>Organisation</th><th>Position</th><th>Access</th><th></th></thead><tbody></tbody></table>");


	                 	let authors = data.data;
	                 	authors.map(function(author) {
	                 		$(".res>table tbody").append("<tr><td class='sticky'>"+`${author.username}`+"</td><td>"+`${author.name}`+"</td><td>"+`${author.organisation}`+"</td><td>"+`${author.position}`+"</td><td>"+`${author.access}`+"</td><td><a class='btn' onclick=\"$('#msg-box').load('message.php #msg-box');\" class='user-edit'>Edit</button><input value='"+`${author._id}`+"' readonly='true' hidden='true'></td></tr>");});
	                 	    
	                 	   
						 $('.res').fadeIn();




						 

						 // $('.popup').fadeIn();

						 //$('.popup div').append("<div>"+token+"</div>");
	                     console.info(data);
	               
	                 }
	                 
	             });
	        //handle failure & empty values(before ajax call) properly
	    });

	    $('.res').on('click','a#addnewuser-btn',function(){
	    	   	$('.popup').fadeOut();
	    	                 	    	
     			$('.popup').html("<form class='popup-content animate'><div class='box'><div class='h'>Add User<span onclick=\"$('.popup').fadeOut()\" class='close' style=' float: right;'>&times</span></div><div><label for='newuser-username'><div class='icon'><i class='fa fa-user'></i></div><input type='text' id='newuser-username' placeholder='Username' required='true'></label></div><div><label for='newuser-name'><div class='icon'><i class='fa fa-user-tie'></i></div><input type='text' id='newuser-name' placeholder='Name' required='true'></label></div><div><label for='newuser-password'><div class='icon'><i class='fa fa-key'></i></div><input type='password' id='newuser-password' placeholder='Password' required='true'></label></div><div><label for='newuser-organisation'><div class='icon'><i class='fa fa-building'></i></div><input type='text' id='newuser-organisation' required='true' placeholder='Organisation'></label></div><div><label for='newuser-position'><div class='icon'><i class='fa fa-group'></i></div><input type='text' id='newuser-position' placeholder='Position' required='true'></label></div><div><label for='newuser-access'><div class='icon'><i class='fa fa-eye'></i></div><select id='newuser-access' required='true'><option value=''>-SELECT access-</option><option value='superadmin'>SuperAdmin</option><option value='adminIIC'>IIC admin</option><option value='adminEDC'>EDC admin</option></select></label></div><div><input type='submit' id='newuser-submit'></div></div></form>");

     				$('.popup form').submit(false);
	    	        $('.popup').fadeIn();
	    	    });

	   $(".popup").on("click","#newuser-submit",function(){

	    	var username_newuser= $('#newuser-username').val(),
            	    	password_newuser= $('#newuser-password').val(),
            	    	name_newuser= $('#newuser-name').val(),
            	    	position_newuser= $('#newuser-position').val() ,
            	    	organisation_newuser= $('#newuser-organisation').val(),
            	    	access_newuser= $('#newuser-access').val() ;
	    	$.ajax({
	                 url: 'https://iic.devclub.in/api/admin/users',
	                 type: 'post',
            	    
            	    headers: {
            	        Authorization: token
            	    },
            	    data: {
            	    	username: username_newuser,
            	    	password: password_newuser,
            	    	name: name_newuser,
            	    	position: position_newuser,
            	    	organisation: organisation_newuser,
            	    	access: access_newuser       	    	
            	    },
            	    dataType: 'json',
	                success: function (data) {
	                	$('.popup').fadeOut();
	                	$('#menu-users').trigger('click');
	                     //console.log(data);
	                 },
	                 fail: function(xhr, textStatus, errorThrown) {alert(errorThrown);}
	             });
	    });

	    


	    $(".res").on("click",".user-edit",function(){
	    	$('.popup').fadeOut();
	    	var user_edit_id=$(this).next().val();
	    	//alert(user_edit_id);

	    	 $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/users/'+user_edit_id,
	                 type: 'get',
            	    
            	    headers: {
            	        Authorization: token 
            	    },
            	    dataType: 'json',
	                 success: function (data) {

	                 	//alert('Hi');


	                 	let authors = data.data;

	                 		$('.popup').fadeOut();
	                 	    	
	                 			$('.popup').html("<form class='popup-content animate'><div class='box'><div class='h'>Add User<span onclick=\"$('.popup').fadeOut()\" class='close' style=' float: right;'>&times</span></div><div><label for='newuser-username'><div class='icon'><i class='fa fa-user'></i></div><input type='text' id='newuser-username' placeholder='Username' required='true'></label></div><div><label for='newuser-name'><div class='icon'><i class='fa fa-user-tie'></i></div><input type='text' id='newuser-name' placeholder='Name' required='true'></label></div><div><label for='newuser-password'><div class='icon'><i class='fa fa-key'></i></div><input type='password' id='newuser-password' placeholder='Password' required='true'></label></div><div><label for='newuser-organisation'><div class='icon'><i class='fa fa-building'></i></div><input type='text' id='newuser-organisation' required='true' placeholder='Organisation'></label></div><div><label for='newuser-position'><div class='icon'><i class='fa fa-group'></i></div><input type='text' id='newuser-position' placeholder='Position' required='true'></label></div><div><label for='newuser-access'><div class='icon'><i class='fa fa-eye'></i></div><select id='newuser-access' required='true'><option value=''>-SELECT access-</option><option value='superadmin'>SuperAdmin</option><option value='adminIIC'>IIC admin</option><option value='adminEDC'>EDC admin</option></select></label></div><div><input type='submit' id='newuser-submit'></div></div></form>");

	                 	    	//$('.popup div').html("<input type='text' id='user-id' placeholder='id' required='true' readonly='true'><form><input type='text' id='user-username' placeholder='username' required='true'><input type='text' id='user-name' placeholder='name' required='true'><select id='user-access' required='true'><option value=''>-SELECT access-</option><option value='superadmin'>SuperAdmin</option><option value='adminIIC'>IIC admin</option><option value='adminEDC'>EDC admin</option></select><input type='text' id='user-position' placeholder='position' required='true'><input type='text' id='user-organisation' required='true'> <input type='submit' value='Update' id='user-update'></form><br><form><label><input type='checkbox' required='true'>Confirm</label><input type='button' value='DELETE' id='user-delete'></form><br><form><input type='password' id='user-password' required='true' placeholder='New Password'><input type='submit' value='Reset Password' id='user-reset-password'></form>");
	                 	    	$('.popup form').submit(false);

	                 	    	


	                 	    	$('#user-username').val(`${authors.username}`);
	                            $('#user-name').val(`${authors.name}`);
	                            $('#user-organisation').val(`${authors.organisation}`);
	                            $('#user-position').val(`${authors.position}`);
	                            $('#user-access').val(`${authors.access}`);
	                            $('#user-id').val(`${authors._id}`);






	                 	    	$('.popup').fadeIn();
	                     console.info(data);
	               
	                 
	                 	

	                 
	           
	             }
	    	});


	    	
	    	
	    });


	    $(".popup div").on("click","#user-update",function(){

	    	var username_user= $('#user-username').val(),
            	    	id_user= $('#user-id').val(),
            	    	name_user= $('#user-name').val(),
            	    	position_user= $('#user-position').val() ,
            	    	organisation_user= $('#user-organisation').val(),
            	    	access_user= $('#user-access').val() ;
	    	$.ajax({
	                 url: 'https://iic.devclub.in/api/admin/users/'+id_user,
	                 type: 'post',
            	    
            	    headers: {
            	        Authorization: token
            	    },
            	    data: {
            	    	username: username_user,
            	    	name: name_user,
            	    	position: position_user,
            	    	organisation: organisation_user,
            	    	access: access_user       	    	
            	    },
            	    dataType: 'json',
	                success: function (data) {
	                	alert("Updated!");
	                	$('#menu-users').trigger('click');
	                     console.log(data);
	                    $('.popup').fadeOut();
	                 }
	             });
	    });

	    $(".popup div").on("click","#user-delete",function(){

	    	var username_user= $('#user-username').val(),
            	    	id_user= $('#user-id').val(),
            	    	name_user= $('#user-name').val(),
            	    	position_user= $('#user-position').val() ,
            	    	organisation_user= $('#user-organisation').val(),
            	    	access_user= $('#user-access').val() ;
	    	$.ajax({
	                 url: 'https://iic.devclub.in/api/admin/users/'+id_user,
	                 type: 'delete',
            	    
            	    headers: {
            	        Authorization: token
            	    },
            	    data: {
            	    	username: username_user,
            	    	name: name_user,
            	    	position: position_user,
            	    	organisation: organisation_user,
            	    	access: access_user       	    	
            	    },
            	    dataType: 'json',
	                success: function (data) {
	                	alert("Updated!");
	                	$('#menu-users').trigger('click');
	                     console.log(data);
	                 }
	             });
	    });
	    $('.popup').fadeOut();

	    $(".popup div").on("click","#user-reset-password",function(){

	    	var password_user= $('#user-password').val(),
            	    	id_user= $('#user-id').val();
	    	$.ajax({
	                 url: 'https://iic.devclub.in/api/admin/users/'+id_user+'/password',
	                 type: 'post',
            	    
            	    headers: {
            	        Authorization: token
            	    },
            	    data: {
            	    	password: password_user,
            	    },
            	    dataType: 'json',
	                success: function (data) {
	                	alert("Reset success!"); 
	                	$('#menu-users').trigger('click');
	                     console.log(data);
	                 }
	             });
	    });

	    

      });

			window.onclick = function(event) {
	   			if (event.target == $('.popup')) {
	        		$('.popup').fadeOut();
	    		}
			}
    </script>
</head>
<body>

	<div class="login">
		<form class="login-content animate" id="login">
			<div class="box">
				<div class="h">Login</div>
				<div><label for="login-username"><div class="icon"><i class="fa fa-user"></i></div><input type="text" name="username" id="login-username" required="true" pattern="[a-zA-Z0-9]+" placeholder="Username"></label></div>
				<div><label for="login-password"><div class="icon"><i class="fa fa-key"></i></div><input type="password" name="password" id="login-password" required="true" placeholder="Password"></label></div>
				<i><span id="login-err"></span></i>
				<div><input type="submit" value="Login" id="login-submit" class="login-btn"></div>
			</div>
		</form>
	</div>
	

	<div class="menu tab" id="menu">
		<div class='tab-item' id='menu-events'>EVENTS</div>
		<div class='tab-item' id='menu-blogs'>BLOGS</div>
		<div class='tab-item' id='menu-resources'>RESOURCES</div>
		<div class='tab-item' id='menu-showcase'>SHOWCASE</div>
		<div class='tab-item' id='menu-team'>TEAM</div>
		
		<div class='tab-item' id='menu-users'>Users</div>

		<hr>		
	</div>
	<div class="res"></div>
	<div class="popup-dump"></div>


	<div class="popup" id="add-newuser-popup"><form class="popup-content animate"><div class="box"><div class="h">Add User<span onclick="$('#add-newuser-popup').fadeOut()" class="close" style=" float: right;">&times</span></div><div><label for='newuser-username'><div class='icon'><i class="fa fa-user"></i></div><input type='text' id='newuser-username' placeholder='Username' required='true'></label></div><div><label for='newuser-name'><div class='icon'><i class="fa fa-user-tie"></i></div><input type='text' id='newuser-name' placeholder='Name' required='true'></label></div><div><label for='newuser-password'><div class='icon'><i class="fa fa-key"></i></div><input type='password' id='newuser-password' placeholder='Password' required='true'></label></div><div><label for='newuser-organisation'><div class='icon'><i class="fa fa-building"></i></div><input type='text' id='newuser-organisation' required='true' placeholder='Organisation'></label></div><div><label for='newuser-position'><div class='icon'><i class="fa fa-group"></i></div><input type='text' id='newuser-position' placeholder='Position' required='true'></label></div><div><label for='newuser-access'><div class='icon'><i class="fa fa-eye"></i></div><select id='newuser-access' required='true'><option value=''>-SELECT access-</option><option value='superadmin'>SuperAdmin</option><option value='adminIIC'>IIC admin</option><option value='adminEDC'>EDC admin</option></select></label></div><div><input type='submit' id='newuser-submit'></div></div></form></div>

</body>

</html>