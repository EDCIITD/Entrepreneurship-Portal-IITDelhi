<!DOCTYPE html>
<html lang="en">
<head>
	<title>Login</title>

    <script src="https://code.jquery.com/jquery-2.2.0.min.js" type="text/javascript"></script>
    <script>

      $(document).ready(function(){
      	$('form').submit(false);
      	$('#menu').css('display', 'none');
      	$('.res').css('display', 'none');
      	$('.popup').css('display', 'none');

        var user,pass,token;
        $("#login-submit").click(function(){
          user=$("#login-username").val();
          pass=$("#login-password").val();
          //$('#res').text(user+" " +pass);
          $.post("https://iic.devclub.in/login",{username: user,password: pass}, function(data){
            if(data.status){
            	token=data.data.token;
            	//$('#res').css('color','black');
            	//$('#res').text("Successful! See Console for results");
            	$.ajax({
            	    url: 'https://iic.devclub.in/api/admin',
            	    type: 'get',
            	    
            	    headers: {
            	        "Authorization": token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
            	    success: function (data) {
            	        console.info(data);
            	    }
            	});
            	$('#login').fadeOut(function(){
            		$('title').text("Welcome "+user);
            		$('#menu').slideDown();
            	});



            }
            else
              {
                //alert("Failed");
                $('#res').css('color','red');
                $('#res').text(data.message);
              }        
          });
        });

        $.Edit = function(what,id){ 

        	if (what=="events"){
        		$.ajax({
	                 url: 'https://iic.devclub.in/api/admin/events/'+id,
	                 type: 'get',
            	    
            	    headers: {
            	        "Authorization": token  
            	    },
            	    dataType: 'json',
	                 success: function (data) {
	                 	//$('.popup div').html("");
	                 	//$('.popup div').append("<table border='1'></table>");
	                 	//$('.popup div table').append("<tr><td>title</td><td><input type='text' ")
	                 	alert("Full feature coming soon! see console for now...");
	                     console.info(data);
	                 }
	             });
        	}
           }


        $("#menu-events").click(function(){
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/events',
	                 type: 'get',
            	    
            	    headers: {
            	        "Authorization": token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
	                 success: function (data) {
	                 	$(".res").html("<table border='1'></table>");


	                 	let authors = data.data;
	                 	 authors.map(function(author) {
	                 		$(".res>table").append("<tr><td>"+`${author.metaData.title}`+"</td><td>"+`${author.metaData.eventDate}`+"</td><td>"+`${author.metaData.eventTime}`+"</td><td>"+`${author.metaData.venue}`+"</td><td>"+`${author.metaData.organiser}`+"</td><td><a onclick=\"$.Edit('events','"+`${author._id}`+"')\" >edit</td></tr>");});

	                 	    
	                 	   
						$('.res').fadeIn();

	                     //console.info(data);
	                
	                 }
	             });
	    });

	    $("#menu-blogs").click(function(){
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/blog',
	                 type: 'get',
            	    
            	    headers: {
            	        "Authorization": token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
	                 success: function (data) {
	                     console.info(data);
	                 }
	             });
	    });

	    $("#menu-resources").click(function(){
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/resources',
	                 type: 'get',
            	    
            	    headers: {
            	        "Authorization": token  //for object property name, use quoted notation shown
            	    },

            	    dataType: 'json',
	                 success: function (data) {
	                     console.info(data);
	                 }
	             });
	    });

	    $("#menu-showcase").click(function(){
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/showcase',
	                 type: 'get',
            	    
            	    headers: {
            	        "Authorization": token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
	                 success: function (data) {
	                     console.info(data);
	                 }
	             });
	    });

	    $("#menu-team").click(function(){
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/team',
	                 type: 'get',
            	    
            	    headers: {
            	        "Authorization": token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
	                 success: function (data) {
	                     console.info(data);
	                 }
	             });
	    });





	    $("#menu-users").click(function(){
	        $.ajax({
	                 url: 'https://iic.devclub.in/api/admin/users',
	                 type: 'get',
            	    
            	    headers: {
            	        "Authorization": token  //for object property name, use quoted notation shown
            	    },
            	    users: {
            	        "access": token  //for object property name, use quoted notation shown
            	    },
            	    dataType: 'json',
	                 success: function (data) {

	                 	$(".res").html("<table border='1'></table>");


	                 	let authors = data.data;
	                 	authors.map(function(author) {
	                 		$(".res>table").append("<tr><td>"+`${author.username}`+"</td><td>"+`${author.name}`+"</td><td>"+`${author.position}`+"</td><td>"+`${author.access}`+"</td><td>"+`${author.organisation}`+"</td><td>manage</td></tr>");});
	                 	    
	                 	   
						 $('.res').fadeIn();


						 $('.popup div').html("<form id='newuser'><input type='text' id='newuser-username' placeholder='username'><input type='text' id='newuser-name' placeholder='name'><input type='password' id='newuser-pass' placeholder='password'><input type='submit' id='newuser-submit'></form>");
						 $('.popup div form').submit(false);

						 $('.popup').fadeIn();
						 $('.popup div').append("<div>"+token+"</div>");
	                     console.info(data);
	                
	                 }
	             });
	    });

	    $(".popup div").on("click","#newuser-submit",function(){

	    	$.ajax({
	                 url: 'https://iic.devclub.in/api/admin/users',
	                 type: 'post',
            	    
            	    headers: {
            	        "Authorization": token  //for object property name, use quoted notation shown
            	    },



            	    data: {
            	    	username: "username",
            	    	password: "password",
            	    	name: "name",
            	    	position: "Pos1",
            	    	organisation: "org",
            	    	access: "user"       	    	
            	    },
            	    dataType: 'json',
	                success: function (data) {
	                     console.log(data);
	                 }
	             });
	    });

      });
    </script>
</head>
<body>
	<form id="login">
		<input type="text" name="username" id="login-username">
		<input type="password" name="password" id="login-password">
		<input type="submit" value="GO" id="login-submit">
		<div id="res"></div>
		<hr>

	</form>

	<div class="menu" id="menu">
		<input type='submit' value='EVENTS' id='menu-events'>
		<input type='submit' value='BLOGS' id='menu-blogs'>
		<input type='submit' value='RESOURCES' id='menu-resources'>
		<input type='submit' value='SHOWCASE' id='menu-showcase'>
		<input type='submit' value='TEAM' id='menu-team'>
		|
		<input type='submit' value='Users' id='menu-users'>

		<hr>		
	</div>
	<div class="res"></div>
	<div class="popup"><span>Partial</span><hr><div></div></div>



</body>
</html>